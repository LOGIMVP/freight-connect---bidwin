<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detailed Shipment View</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        // Tailwind configuration for the "Inter" font
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'custom-green': '#34D399', // A nice vibrant green for actions
                    }
                },
            },
        }
    </script>
    
    <style>
        /* General styling for the page */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        /* Custom class for the card shadows/look */
        .info-card {
            border: 1px solid #e5e7eb; /* Subtle border */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06); /* Standard shadow */
        }
        /* Style for the active drag zone */
        .drag-active {
            border-color: #3b82f6 !important; /* Blue-500 */
            background-color: #eff6ff !important; /* Blue-50 */
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto space-y-6">

        <!-- HEADER ROW: TITLE AND LIVE TRACKING INPUT -->
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center pb-4 space-y-2 sm:space-y-0">
            <h1 class="text-2xl font-extrabold text-gray-800 whitespace-nowrap">
                Detailed Shipment Information
            </h1>
            
            <!-- TRACKING LINK INPUT FIELD -->
            <div class="flex flex-col sm:flex-row items-start sm:items-center text-sm w-full sm:w-auto">
                <label for="tracking-link" class="font-semibold text-gray-700 mr-2 whitespace-nowrap">Live Tracking Link:</label>
                <input 
                    type="url" 
                    id="tracking-link" 
                    value="https://cloud.samsara.com/load-details/L-4839"
                    placeholder="https://cloud.samsara.com/..."
                    class="w-full sm:w-64 p-1 border border-gray-300 rounded-md text-sm text-blue-600 focus:ring-blue-500 focus:border-blue-500 truncate transition duration-150 shadow-inner"
                    oninput="handleLinkChange()"
                />
            </div>
        </div>

        <!-- --- MAIN GRID LAYOUT --- -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

            <!-- STOPS ROW (Uses full width but is internally a grid-cols-2) -->
            <div class="md:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-6">
                <!-- Pickup Card -->
                <div class="bg-white p-6 rounded-xl info-card h-full flex flex-col justify-between">
                    <div>
                        <h2 class="text-base font-semibold text-gray-700 mb-3">Pickup Stops (1):</h2>
                        <div class="space-y-1">
                            <p class="font-semibold text-gray-800">123 Oilfield Way, Edmonton, AB, T5J 0K6</p>
                            <p class="text-gray-600 text-sm">Contact: Edmonton Supply</p>
                        </div>
                    </div>
                    <div class="pt-3 text-right">
                        <a href="tel:7805550500" class="text-sm font-bold text-blue-600 hover:underline">
                            780-555-0500
                        </a>
                    </div>
                </div>

                <!-- Delivery Card -->
                <div class="bg-white p-6 rounded-xl info-card h-full flex flex-col justify-between">
                    <div>
                        <h2 class="text-base font-semibold text-gray-700 mb-3">Delivery Stops (1):</h2>
                        <div class="space-y-1">
                            <p class="font-semibold text-gray-800">789 Central Goods Rd, Winnipeg, MB, R3C 0B4</p>
                            <p class="text-gray-600 text-sm">Contact: Central Logistics</p>
                            <p class="text-gray-600 text-sm">Email: wpg.logistics@example.com</p>
                        </div>
                    </div>
                    <div class="pt-3 text-right">
                        <a href="tel:2045550700" class="text-sm font-bold text-purple-600 hover:underline">
                            204-555-0700
                        </a>
                    </div>
                </div>
            </div>

            <!-- LEFT COLUMN: SPECS AND SKIDS -->
            <div class="flex flex-col space-y-6">
                
                <!-- Shipment Specifications Card -->
                <div class="bg-white p-6 rounded-xl info-card">
                    <h2 class="text-lg font-bold text-gray-700 mb-4">Shipment Specifications</h2>
                    <div class="grid grid-cols-2 gap-x-4 gap-y-3 border-y border-gray-100 py-3">
                        
                        <!-- LTL/Dry Van -->
                        <div class="text-sm text-gray-500">Equipment</div>
                        <div class="text-right">
                            <p class="font-bold text-base text-gray-800">LTL</p>
                            <p class="text-xs text-gray-500">(Dry Van)</p>
                        </div>

                        <!-- Weight -->
                        <div class="text-sm text-gray-500">Total Weight</div>
                        <div class="text-right">
                            <p class="font-bold text-base text-gray-800">9,000 lbs</p>
                        </div>
                        
                        <!-- Skid Quantity -->
                        <div class="text-sm text-gray-500">Total Skid Quantity</div>
                        <div class="text-right">
                            <p class="font-bold text-base text-gray-800">9</p>
                        </div>

                        <!-- Linear Feet -->
                        <div class="text-sm text-gray-500">Est. Linear Feet</div>
                        <div class="text-right">
                            <p class="font-bold text-base text-gray-800">12.5 ft</p>
                        </div>
                    </div>
                </div>
                
                <!-- Skid Details Card -->
                <div class="bg-white p-6 rounded-xl info-card">
                    <h2 class="text-lg font-bold text-gray-700 mb-4">Skid Details</h2>
                    <table class="w-full text-sm text-gray-700">
                        <thead class="text-xs text-gray-600 uppercase bg-gray-50 rounded-t-lg">
                            <tr>
                                <th scope="col" class="py-2 px-1 text-left font-medium rounded-tl-lg">Quantity</th>
                                <th scope="col" class="py-2 text-center font-medium">Dimensions (L×W×H IN)</th>
                                <th scope="col" class="py-2 px-1 text-right font-medium rounded-tr-lg">Weight per Skid (LBS)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="bg-white border-b last:border-b-0">
                                <td class="py-3 px-1 font-bold text-gray-800 text-left">9</td>
                                <td class="py-3 font-bold text-gray-800 text-center">40 x 40 x 40</td>
                                <td class="py-3 px-1 font-bold text-gray-800 text-right">1,000</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>

            <!-- RIGHT COLUMN: SCHEDULING AND ATTACHMENTS -->
            <div class="flex flex-col space-y-6">
                
                <!-- Scheduling Card -->
                <div class="bg-white p-6 rounded-xl info-card">
                    <h2 class="text-lg font-bold text-gray-700 mb-4">Scheduling</h2>
                    <div class="space-y-3 divide-y divide-gray-100">
                        <!-- Pickup Deadline -->
                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                            <p class="text-sm text-gray-500">Pickup Deadline</p>
                            <p class="font-bold text-base text-red-600">Nov 18, 2025</p>
                        </div>
                        <!-- Drop Off Deadline -->
                        <div class="flex justify-between items-center py-3 last:border-b-0">
                            <p class="text-sm text-gray-500">Drop Off Deadline</p>
                            <p class="font-bold text-base text-red-600">Nov 21, 2025</p>
                        </div>
                    </div>
                </div>
                
                <!-- Attachments Card -->
                <div class="bg-white p-6 rounded-xl info-card flex-grow">
                    <h2 class="text-lg font-bold text-gray-700 mb-4">Attachments</h2>
                    
                    <div id="attachments-container" class="space-y-4">
                        <!-- Shipper Documents Section (Static/Non-Editable for Carrier) -->
                        <div>
                            <p class="text-base font-semibold text-gray-700 mb-2">Shipper Documents:</p>
                            <div class="flex items-center justify-between text-sm p-2 rounded-lg bg-white">
                                <div class="flex items-center space-x-2 w-2/3 truncate">
                                    <!-- Simple File Icon SVG -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-gray-500 flex-shrink-0"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>
                                    <span class="truncate font-medium text-gray-700">pickup_ref_54321.pdf</span>
                                </div>
                                <div class="flex space-x-2 flex-shrink-0">
                                    <button class="px-3 py-1 text-xs text-blue-600 border border-blue-200 bg-white rounded-full hover:bg-blue-50 transition duration-150 font-semibold" onclick="showMessage('Viewing document...')">
                                        View
                                    </button>
                                    <button class="flex items-center px-3 py-1 text-xs text-white bg-gray-600 rounded-full hover:bg-gray-700 transition duration-150 shadow-sm font-semibold" onclick="showMessage('Downloading document...')">
                                        Download
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Carrier Documents Section (Editable) -->
                        <div>
                            <p class="text-base font-semibold text-gray-700 mb-2 mt-4">Carrier Documents:</p>
                            
                            <!-- Documents will be rendered here by JavaScript -->
                            <div id="carrier-documents-list" class="space-y-2">
                                <!-- Dynamic content inserted by renderCarrierDocuments() -->
                            </div>
                            <!-- END carrier-documents-list -->

                            <!-- File Upload/Drop Zone (Now clickable and D&D enabled) -->
                            <div 
                                id="drop-zone"
                                class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer hover:bg-blue-50 transition mt-4" 
                                onclick="document.getElementById('file-upload').click()"
                                ondragover="handleDragOver(event)"
                                ondragleave="handleDragLeave(event)"
                                ondrop="handleDrop(event)"
                            >
                                <div class='flex flex-col items-center justify-center text-blue-500 font-semibold pointer-events-none'>
                                    <!-- Upload Icon SVG -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 mb-1"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                                    Click to upload or drag and drop (Max 10MB)
                                </div>
                                <!-- Hidden file input -->
                                <input type="file" id="file-upload" class="hidden" multiple onchange="handleFileSelect(event)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SPECIAL NOTES (Full Width) -->
            <div class="md:col-span-2">
                <div class="bg-yellow-100 p-4 rounded-xl info-card border-yellow-300">
                    <h2 class="text-lg font-bold text-gray-700 mb-2">Special Notes</h2>
                    <p class="text-base text-gray-700">Pickup by appointment only.</p>
                </div>
            </div>
        </div>

        <!-- UNSAVED CHANGES ACTION PANEL (NOW AT THE BOTTOM) -->
        <div id="unsaved-changes-banner" class="mt-6 flex flex-col md:flex-row justify-between items-center bg-indigo-100 p-4 rounded-xl shadow-lg border border-indigo-300 transition duration-300 hidden">
            <p class="text-base font-semibold text-indigo-800 mb-3 md:mb-0 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 mr-2 text-red-500"><path d="M18 6L6 18"/><path d="M6 6L18 18"/></svg>
                You have unsaved changes.
            </p>
            <div class="flex space-x-3 w-full md:w-auto justify-end">
                <button 
                    class="flex-1 md:flex-none px-4 py-2 text-sm font-bold text-indigo-600 bg-white border border-indigo-300 rounded-full hover:bg-indigo-50 transition shadow-md flex items-center justify-center" 
                    onclick="cancelChanges()"
                >
                    Cancel Update
                </button>
                <button 
                    class="flex-1 md:flex-none px-6 py-2 text-sm font-bold text-white bg-indigo-600 rounded-full hover:bg-indigo-700 transition shadow-lg flex items-center justify-center" 
                    onclick="saveChanges()"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 mr-2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                    Update Changes
                </button>
            </div>
        </div>


        <!-- RATE CONFIRMED BANNER (Always at the very bottom) -->
        <div class="mt-8 flex flex-col md:flex-row justify-between items-center bg-custom-green/20 p-4 rounded-xl shadow-lg border-2 border-custom-green">
            <p class="text-xl font-bold text-green-800 mb-3 md:mb-0 flex items-center">
                You won this bid! Rate: <span class="text-2xl font-extrabold ml-2">$1,100</span>
            </p>
            <div class="flex space-x-3 w-full md:w-auto justify-end">
                <button 
                    class="flex-1 md:flex-none px-4 py-2 text-sm font-semibold text-red-600 border border-red-400 bg-white rounded-full hover:bg-red-50 transition shadow-sm" 
                    onclick="showModal('Cancel Shipment', 'Are you sure you want to cancel this shipment? This action cannot be undone.', 'cancel')"
                >
                    Cancel Shipment
                </button>
                <button 
                    class="flex-1 md:flex-none px-4 py-2 text-sm font-semibold text-white bg-green-500 rounded-full hover:bg-green-600 transition shadow-lg" 
                    onclick="showModal('Mark as Delivered', 'Confirming delivery will finalize this shipment. Are you sure?', 'delivered')"
                >
                    Mark as Delivered
                </button>
            </div>
        </div>
        
        <!-- Custom Confirmation Modal (FIXED AND CENTERED) -->
        <div id="confirmation-modal" class="fixed inset-0 z-50 hidden bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 transition-opacity duration-300" aria-modal="true" role="dialog">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
                <h3 id="modal-title" class="text-xl font-bold text-gray-900 mb-4"></h3>
                <p id="modal-message" class="text-sm text-gray-600 mb-6"></p>

                <div class="flex justify-end space-x-3">
                    <button 
                        onclick="hideModal()"
                        class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-full hover:bg-gray-200 transition"
                    >
                        Go Back
                    </button>
                    <button 
                        id="modal-confirm-button"
                        class="px-4 py-2 text-sm font-medium text-white rounded-full transition shadow-md"
                        onclick="executeAction()"
                    >
                        Confirm
                    </button>
                </div>
            </div>
        </div>

    </div>

    <!-- JavaScript for Functionality and State Management -->
    <script>
        let currentAction = '';
        const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
        let isModified = false;

        // --- Simulated Initial Data State ---
        // In a real application, this would be fetched from a database.
        const initialShipmentData = {
            trackingLink: document.getElementById('tracking-link').value,
            carrierDocuments: [
                // Existing document (isNew: false)
                { id: 'doc-L4839', name: 'loading_invoice_L4839.pdf', url: '#', isNew: false } 
            ]
        };
        let currentShipmentData = JSON.parse(JSON.stringify(initialShipmentData)); // Deep copy for mutable state

        // --- UI State Toggling ---

        function toggleSaveButtons(show) {
            const banner = document.getElementById('unsaved-changes-banner');
            isModified = show;
            if (show) {
                banner.classList.remove('hidden');
            } else {
                banner.classList.add('hidden');
            }
        }

        function checkModificationStatus() {
            const currentLink = document.getElementById('tracking-link').value;
            const isLinkChanged = currentLink !== initialShipmentData.trackingLink;
            
            // Check if document lists are different (length or content)
            const initialDocNames = initialShipmentData.carrierDocuments.map(doc => doc.name).sort().join('|');
            const currentDocNames = currentShipmentData.carrierDocuments.map(doc => doc.name).sort().join('|');
            const isDocsChanged = initialDocNames !== currentDocNames;

            // Log status to help the user diagnose in the console
            console.log(`--- Modification Check ---`);
            console.log(`Link: '${currentLink}' vs Initial: '${initialShipmentData.trackingLink}' -> Changed: ${isLinkChanged}`);
            console.log(`Docs Changed: ${isDocsChanged}`);
            console.log(`Showing Update Buttons: ${isLinkChanged || isDocsChanged}`);
            console.log(`--------------------------`);

            toggleSaveButtons(isLinkChanged || isDocsChanged);
        }

        // --- Action Handlers ---

        function handleLinkChange() {
            checkModificationStatus();
        }

        function saveChanges() {
            // 1. Update initial/saved state to current state
            initialShipmentData.trackingLink = document.getElementById('tracking-link').value;
            // When saving, clear the 'isNew' flag for all current documents and update the initial state
            initialShipmentData.carrierDocuments = currentShipmentData.carrierDocuments.map(doc => ({
                ...doc,
                isNew: false // Mark all as saved
            }));
            currentShipmentData = JSON.parse(JSON.stringify(initialShipmentData));

            // 2. Hide the banner and update UI
            toggleSaveButtons(false);
            showMessage('Shipment details and documents UPDATED successfully (simulated).');

            // 3. Re-render documents to show the updated state
            renderCarrierDocuments(); 
        }

        function cancelChanges() {
            // 1. Reset current state to initial state
            currentShipmentData.trackingLink = initialShipmentData.trackingLink;
            currentShipmentData.carrierDocuments = JSON.parse(JSON.stringify(initialShipmentData.carrierDocuments)); // Deep copy

            // 2. Reset the tracking link input field
            document.getElementById('tracking-link').value = initialShipmentData.trackingLink;

            // 3. Hide the banner and refresh documents
            toggleSaveButtons(false);
            renderCarrierDocuments();
            showMessage('Changes CANCELLED. Data reset to last saved state.');
        }

        function removeDocument(fileName, docId) {
            currentShipmentData.carrierDocuments = currentShipmentData.carrierDocuments.filter(doc => doc.id !== docId);
            renderCarrierDocuments();
            checkModificationStatus();
            showMessage(`Document ${fileName} marked for removal. Click 'Update Changes' to confirm.`);
        }
        
        // --- Document Rendering ---

        function renderCarrierDocuments() {
            const listContainer = document.getElementById('carrier-documents-list');
            listContainer.innerHTML = ''; // Clear existing documents

            if (currentShipmentData.carrierDocuments.length === 0) {
                 listContainer.innerHTML = '<p class="text-sm text-gray-500 italic p-2">No carrier documents uploaded yet.</p>';
                 return;
            }

            currentShipmentData.carrierDocuments.forEach(doc => {
                const docElement = document.createElement('div');
                docElement.id = doc.id;
                docElement.className = 'flex items-center justify-between text-sm p-2 rounded-lg bg-white border border-gray-100';
                
                // Determine if the download button should be present
                // Download is ONLY visible if the document has been SAVED (isNew: false)
                const downloadButton = doc.isNew ? '' : `
                    <button class="flex items-center px-3 py-1 text-xs text-white bg-gray-600 rounded-full hover:bg-gray-700 transition duration-150 shadow-sm font-semibold" onclick="showMessage('Downloading document: ${doc.name}')">
                        Download
                    </button>
                `;

                // Content HTML
                docElement.innerHTML = `
                    <div class="flex items-center space-x-2 w-2/3 truncate">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-gray-500 flex-shrink-0"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>
                        <span class="truncate font-medium text-gray-700">${doc.name}</span>
                    </div>
                    <div class="flex space-x-2 flex-shrink-0">
                        <button class="px-3 py-1 text-xs text-blue-600 border border-blue-200 bg-white rounded-full hover:bg-blue-50 transition duration-150 font-semibold" onclick="showMessage('Viewing document: ${doc.name}')">
                            View
                        </button>
                        ${downloadButton}
                        <button class="flex items-center px-3 py-1 text-xs text-white bg-red-500 rounded-full hover:bg-red-600 transition duration-150 shadow-sm font-semibold" onclick="removeDocument('${doc.name}', '${doc.id}')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-3 h-3 mr-1"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                            Remove
                        </button>
                    </div>
                `;
                listContainer.appendChild(docElement);
            });
        }
        
        // --- File Upload / Drag-and-Drop Handlers ---

        function handleDragOver(event) {
            event.preventDefault();
            document.getElementById('drop-zone').classList.add('drag-active');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            document.getElementById('drop-zone').classList.remove('drag-active');
        }

        function handleDrop(event) {
            event.preventDefault();
            document.getElementById('drop-zone').classList.remove('drag-active');
            
            const files = event.dataTransfer.files;
            processFiles(files);
        }

        function handleFileSelect(event) {
            const files = event.target.files;
            processFiles(files);
            event.target.value = '';
        }

        function processFiles(files) {
            if (files.length === 0) return;

            let uploadedCount = 0;
            let rejectedCount = 0;

            for (let i = 0; i < files.length; i++) {
                const file = files[i];

                if (file.size > MAX_FILE_SIZE) {
                    console.error(`File Rejected: ${file.name} is too large.`);
                    rejectedCount++;
                    continue;
                }

                console.log(`Simulated Upload: ${file.name}`);
                
                // Add the new file to the current state with a unique ID
                currentShipmentData.carrierDocuments.push({
                    id: 'new-' + Date.now() + '-' + i,
                    name: file.name,
                    url: '#',
                    isNew: true // Flag remains internally for logic
                });
                uploadedCount++;
            }

            if (uploadedCount > 0) {
                renderCarrierDocuments();
                checkModificationStatus();
                const fileString = uploadedCount > 1 ? `${uploadedCount} files` : files[0].name;
                showMessage(`Successfully added ${fileString}. Click 'Update Changes' to confirm.`);
            }
            
            if (rejectedCount > 0) {
                showMessage(`Warning: ${rejectedCount} file(s) were too large and skipped.`);
            }
        }

        // --- Modal Functionality ---

        /**
         * Displays the custom modal with dynamic content and sets the action.
         * @param {string} title The title of the modal.
         * @param {string} message The confirmation message.
         * @param {string} actionType 'cancel' or 'delivered'.
         */
        function showModal(title, message, actionType) {
            const modal = document.getElementById('confirmation-modal');
            const modalContent = document.getElementById('modal-content');
            const confirmButton = document.getElementById('modal-confirm-button');

            // Set content
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-message').innerText = message;
            currentAction = actionType;

            // Set button style and text based on action
            if (actionType === 'cancel') {
                // CONFIRM CANCELLATION BUTTON TEXT RETAINED
                confirmButton.innerText = 'Confirm Cancellation'; 
                confirmButton.classList.remove('bg-green-500', 'hover:bg-green-600');
                confirmButton.classList.add('bg-red-500', 'hover:bg-red-600');
            } else if (actionType === 'delivered') {
                confirmButton.innerText = 'Yes, Mark Delivered';
                confirmButton.classList.remove('bg-red-500', 'hover:bg-red-600');
                confirmButton.classList.add('bg-green-500', 'hover:bg-green-600');
            }

            // Show the modal with transition effects
            modal.classList.remove('hidden');
            // Give the browser a moment to apply 'display: flex' before applying transitions
            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        /**
         * Hides the custom modal.
         */
        function hideModal() {
            const modal = document.getElementById('confirmation-modal');
            const modalContent = document.getElementById('modal-content');

            // Start transition out
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            
            // Hide after transition
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        /**
         * Executes the confirmed action.
         */
        function executeAction() {
            hideModal();
            
            if (currentAction === 'cancel') {
                showMessage('Shipment L-4839 has been CANCELLED (simulated).');
            } else if (currentAction === 'delivered') {
                showMessage('Shipment L-4839 marked DELIVERED (simulated). Payment initiated.');
            }
            currentAction = ''; // Reset action
        }

        /**
         * Shows a temporary, custom message box (instead of alert()).
         */
        function showMessage(msg) {
            const messageBox = document.getElementById('message-box');
            
            // Set message and show
            messageBox.innerText = msg;
            messageBox.classList.remove('hidden', 'opacity-0');
            messageBox.classList.add('opacity-100');
            
            // Auto-hide the message after 4 seconds
            setTimeout(() => {
                messageBox.classList.remove('opacity-100');
                messageBox.classList.add('opacity-0');
                
                // Fully hide after fade transition completes (300ms)
                setTimeout(() => {
                    messageBox.classList.add('hidden');
                }, 300);
            }, 4000);
        }

        // Initial render to show default carrier documents
        window.onload = function() {
            // This ensures the current documents are rendered from the JS state
            renderCarrierDocuments(); 
        };
    </script>

    <!-- Message Box (Used instead of alert()) -->
    <div id="message-box" class="fixed bottom-4 right-4 z-50 p-4 rounded-xl shadow-xl text-gray-800 bg-blue-300/90 font-medium text-sm transition-opacity duration-300 opacity-0 hidden">
        Action executed successfully.
    </div>
</body>
</html>
